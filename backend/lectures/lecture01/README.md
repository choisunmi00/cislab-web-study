### **백엔드 웹 개발 입문자를 위한 FastAPI 스터디 강의 자료 구성**

**강의 목표:**

- FastAPI의 기본 동작 원리 및 주요 개념 이해
- 경로 매개변수, 쿼리 매개변수, 요청 본문을 효과적으로 다루는 방법 습득
- FastAPI의 자동 데이터 유효성 검증 및 문서화 기능 활용 능력 배양
- Pydantic을 활용한 견고한 데이터 모델링 방법 이해

---

#### **Part 1: FastAPI 기본 개념 및 경로/쿼리 매개변수 이해**

**1.1 FastAPI 소개 및 기본 개념**

- **백엔드 웹 개발이란?** 간략한 설명과 FastAPI의 역할 소개.
- **FastAPI는 무엇인가?** Python 기반의 고성능 웹 프레임워크임을 강조합니다.
- **왜 FastAPI를 사용하는가?**
  - Python 타입 힌트 (Type Hint) 활용의 중요성 강조.
  - 타입 힌트가 제공하는 자동 기능들: 데이터 파싱, 유효성 검증, 자동 문서화, 편집기 지원.
  - 다른 프레임워크와 비교했을 때 FastAPI의 주요 장점 (생산성, 견고함, 빠른 성능).
- **간단한 "Hello World" 예제로 첫걸음 떼기** (자료에 명시적인 코드는 없지만, 실습을 위해 포함 필요).

**1.2 경로 매개변수 (Path Parameters)**

- **경로 매개변수란?** URL 경로에 포함되는 변수이며, `{item_id}`와 같이 중괄호를 사용하여 정의함을 설명합니다.
- **타입 선언 및 자동 처리:**
  - Python 타입 힌트(`item_id: int`)를 사용하여 매개변수 타입을 선언하면, FastAPI가 문자열 요청을 해당 타입으로 자동 변환합니다. 예를 들어, `"3"`은 `int`형 `3`으로 변환됩니다.
- **데이터 유효성 검사:**
  - 타입 힌트를 통해 유효성 검사가 자동으로 이루어지며, 유효하지 않은 값이 전달되면 명확한 HTTP 오류 메시지를 반환합니다.
- **자동 문서화 (Swagger UI/ReDoc):**
  - 타입 힌트만으로도 FastAPI가 Swagger UI를 통해 대화형 API 문서를 자동 생성하고, 경로 매개변수의 타입 정보가 문서에 명시됨을 보여줍니다.
  - OpenAPI 표준을 따르므로 ReDoc과 같은 대체 도구도 활용 가능합니다.
- **경로 작동의 순서 문제:**
  - 고정 경로(예: `/users/me`)는 변수 경로(예: `/users/{user_id}`)보다 먼저 선언되어야 오작동을 피할 수 있음을 강조합니다.
- **사전 정의 값 (Enum):**
  - Python의 `Enum`을 사용하여 경로 매개변수로 가능한 값들을 미리 정의하고, API 문서에 올바르게 표시되도록 `str`을 상속하는 방법을 설명합니다.
  - 열거형 멤버를 직접 비교하거나 `.value`를 통해 실제 문자열 값을 가져오는 방법을 보여줍니다.
- **경로를 포함하는 경로 매개변수:**
  - `file_path` 자체가 경로를 포함하는 경우(예: `/files/home/johndoe/myfile.txt`), Starlette의 경로 변환기를 사용하여 `/files/{file_path:path}`와 같이 선언할 수 있음을 설명합니다.

**1.3 쿼리 매개변수 (Query Parameters)**

- **쿼리 매개변수란?** URL에 `?key=value` 형태로 포함되는 선택적 또는 필수적인 키-값 쌍임을 설명합니다.
- **자동 파싱, 검증, 문서화:** 경로 매개변수와 마찬가지로 Python 타입 힌트를 통해 자동 처리됩니다.
- **기본값 및 선택적 매개변수:**
  - 함수 매개변수에 기본값을 할당하여 선택적으로 만들 수 있습니다.
  - `Union[str, None] = None` 또는 `str | None = None`을 사용하여 선택적 매개변수를 명시적으로 선언할 수 있습니다.
- **타입 변환:** `bool` 타입으로 선언하면 `"1"`, `"True"`, `"on"`, `"yes"` 등이 자동으로 `True`로 변환되는 예시를 보여줍니다.
- **여러 경로/쿼리 매개변수 혼합:** FastAPI는 매개변수 이름으로 각각을 인식하므로 선언 순서에 구애받지 않음을 설명합니다.
- **필수 쿼리 매개변수:**
  - 기본값을 선언하지 않거나 `Query(...)`의 첫 번째 인자로 `...` (Ellipsis)를 사용하여 쿼리 매개변수를 필수로 만들 수 있습니다. 누락 시 유효성 검사 오류가 발생합니다.
- **쿼리 매개변수 리스트/다중 값:**
  - `List[str]` 또는 `list[str]`와 같이 타입을 선언하고 `Query`를 명시적으로 사용하면 동일한 쿼리 매개변수 이름으로 여러 값을 리스트로 받을 수 있음을 설명합니다.
  - 기본값 리스트 설정도 가능합니다.

---

#### **Part 2: 요청 본문 처리 및 고급 유효성 검사**

**2.1 숫자 검증 (Numeric Validations) 상세**

- **`Path` 및 `Query` 임포트:** `fastapi`에서 `Path`와 `Query`를 임포트하여 숫자 매개변수에 대한 상세 유효성 검사를 추가하는 방법을 설명합니다.
- **메타데이터 선언:** `title`, `description` 등 매개변수 메타데이터를 추가하는 방법을 보여줍니다.
- **매개변수 정렬:** Python의 매개변수 순서 제약과 FastAPI의 유연성을 설명하고, `*`를 사용하여 키워드 인자(kwargs)를 강제하는 트릭을 소개합니다.
- **숫자 검증 키워드:**
  - `ge` (크거나 같음), `gt` (큼), `le` (작거나 같음), `lt` (작음)를 사용하여 숫자 범위 검증을 추가하는 방법을 예시와 함께 설명합니다.
  - `float` 값에 대한 검증도 동일하게 적용됨을 보여줍니다.

**2.2 요청 본문 (Request Body) 상세**

- **요청 본문 개념 재확인:** 클라이언트에서 API로 데이터를 보낼 때 사용하며, `POST`, `PUT`, `PATCH` 요청에 권장됨을 다시 강조합니다.
- **Pydantic `BaseModel` 사용:**
  - `BaseModel`을 상속하여 데이터 모델을 정의하고, 각 속성을 Python 타입 힌트로 선언하는 방법을 설명합니다.
  - `None`을 기본값으로 설정하여 선택적 필드를 만드는 방법을 보여줍니다.
- **FastAPI의 자동 처리 기능:**
  - 요청 본문을 JSON으로 읽어 해당 타입으로 변환하고, 유효성 검사 및 오류 메시지 반환, 편집기 지원, 모델의 JSON 스키마 생성 및 자동 문서화에 활용됨을 자세히 설명합니다.
- **매개변수 조합:** 경로 매개변수, 쿼리 매개변수, 요청 본문 매개변수를 자유롭게 혼합하여 사용할 수 있으며, FastAPI가 각각을 자동으로 인식하는 원리를 설명합니다.

**2.3 요청 본문 고급 활용 (Body Advanced)**

- **다중 본문 매개변수:** 여러 개의 Pydantic 모델을 본문 매개변수로 선언하면, FastAPI가 본문의 필드 이름을 해당 모델에 매핑하여 자동 변환 및 검증함을 설명합니다.
- **본문 내 단일 값 (`Body()`):**
  - Pydantic 모델 외에 단일 값(예: `int`)을 요청 본문에 포함하려면 `fastapi.Body`를 사용하여 명시적으로 선언해야 함을 보여줍니다.
- **단일 본문 매개변수 삽입 (`Body(embed=True)`):**
  - 단일 Pydantic 모델을 본문으로 받을 때, 모델을 본문 내 특정 키(필드명)로 래핑하도록 강제하는 `Body(embed=True)` 옵션의 사용법을 설명합니다.
- **`Field`를 활용한 Pydantic 모델 필드 검증:**
  - `pydantic`에서 `Field`를 임포트하여 모델 속성 내에서 추가 유효성 검사 및 메타데이터(예: `title`, `description`, `min_length`, `max_length`, `ge`, `gt`, `le`, `lt`)를 선언하는 방법을 자세히 설명합니다.

**2.4 중첩 모델 (Nested Models)**

- **Pydantic의 중첩 모델 지원:** FastAPI가 Pydantic 덕분에 깊이 중첩된 모델을 정의, 검증, 문서화하고 사용할 수 있음을 강조합니다.
- **리스트 필드:**
  - `tags: list = []`와 같은 단순 리스트 선언과, `typing.List` 또는 Python 3.9+의 `list`를 사용하여 `tags: List[str] = []`와 같이 리스트 내부의 타입(str)을 명시적으로 선언하는 방법을 설명합니다.
- **집합 타입 (`Set`):** `tags: Set[str] = set()`와 같이 `Set` 타입을 사용하여 중복을 허용하지 않는 고유한 값들의 집합을 받을 수 있음을 설명합니다.
- **중첩 모델 정의:**
  - Pydantic 모델의 속성 타입으로 다른 Pydantic 모델을 사용하여 깊이 중첩된 JSON "객체"를 선언하는 방법을 예시와 함께 설명합니다 (예: `Item` 모델 안에 `Image` 모델 포함).
- **특별한 타입 및 검증:** `HttpUrl`과 같이 더 복잡한 "이국적인 타입" (exotic types)을 활용하여 유효한 URL 검증 등을 수행할 수 있음을 소개합니다.
- **서브모델 리스트:** `images: Union[List[Image], None] = None`와 같이 Pydantic 모델의 리스트를 속성으로 가질 수 있음을 보여줍니다.
- **깊게 중첩된 모델:** 원하는 만큼 모델을 깊게 중첩할 수 있음을 설명합니다 (예: `Offer` 모델 안에 `Item` 모델의 리스트 포함).
- **편집기 지원 및 `dict` 본문:** Pydantic 모델 사용 시 강력한 편집기 지원을 받을 수 있음을 강조하고, 키와 값의 타입을 가진 `dict`를 본문으로 선언하는 방법도 설명합니다.

**2.5 쿼리 매개변수 모델 (Query Parameter Models) - FastAPI 0.115.0 이상**

- **개념 및 재사용성:** 관련된 쿼리 매개변수 그룹을 Pydantic 모델을 사용하여 선언하여 코드 재사용성과 검증 효율성을 높이는 방법을 설명합니다.
- **Pydantic 모델 사용:** 필요한 쿼리 매개변수를 Pydantic 모델 안에 정의한 다음, 해당 모델을 `Query`로 선언하는 방법을 보여줍니다.
- **자동 추출 및 문서화:** FastAPI가 요청의 쿼리 매개변수에서 각 필드의 데이터를 추출하여 Pydantic 모델 인스턴스로 제공하며 API 문서에도 반영됨을 설명합니다.
- **추가 쿼리 매개변수 금지:** `model_config = {"extra": "forbid"}` (Pydantic v2) 또는 `Config.extra = "forbid"` (Pydantic v1) 설정을 통해 모델에 정의되지 않은 추가 쿼리 매개변수를 금지할 수 있음을 설명합니다.

**2.6 요청 예제 데이터 선언 (Request Example Data Declaration)**

- **API 문서의 유용성 향상:** API 문서에 요청 예제 데이터를 선언하여 사용자에게 API 사용 방법을 명확하게 제공하는 중요성을 강조합니다.
- **Pydantic 모델 내 `json_schema_extra`:**
  - Pydantic 모델의 `model_config` (Pydantic v2) 또는 `Config.schema_extra` 딕셔너리에 `json_schema_extra` 키를 추가하여 `examples`를 포함한 추가 JSON 스키마 데이터를 정의하는 방법을 설명합니다.
- **`Body()`, `Query()`, `Path()` 등의 `examples` 인자:**
  - 이 함수들에 `examples` 매개변수를 사용하여 예상되는 예제 데이터를 리스트 형태로 전달할 수 있음을 보여줍니다.
- **`openapi_examples` 매개변수 (FastAPI 0.103.0 이상):**
  - Swagger UI의 다중 예제 표현 문제를 해결하기 위해 도입된 `openapi_examples` 매개변수 사용법을 설명합니다. 이는 `summary`, `description`, `value`, `externalValue` 등의 필드를 포함하는 다중 예제(딕셔너리 형태)를 선언할 수 있게 합니다.
  - `examples`와 `openapi_examples`의 차이점 및 사용 사례를 명확히 구분합니다.
